# Статус агентов и аналитических инструментов

Обновлено: 2025-09-18

## Обзор

Ниже — текущая оценка основных агентов и сервисов, влияющих на сбор сигналов, аналитику и торговые рекомендации. Таблица отражает сильные стороны, обнаруженные проблемы и приоритетные действия для повышения точности прогнозов.

| Компонент | Назначение | Состояние | Риски/проблемы | Рекомендованные действия |
|-----------|------------|-----------|----------------|--------------------------|
| `agents/alpha_hunter.py` | Сбор сделок топ-трейдеров, майнинг стратегий, обратный инжиниринг | **Обновлён**: HTTP с ретраями, cost-aware бэктест, метрики влияния | Всё ещё зависим от публичных API и качества данных, нет e2e-интеграционных тестов | Подготовить стабилизацию источников (прокси/кэш), оценить влияние стратегий на PnL по факту, расширить тесты (network mocks) |
| `agents/smc_analyst.py` | Smart Money Concepts: тренд, ликвидность, зоны входа | **Обновлён**: кэширование OHLCV, покрыт юнит-тестами | Логика SMC остаётся эвристической, требуется валидация на реальных эпизодах | Собрать размеченные кейсы, калибровать правила (sweep/CHOCH), добавить бэктест точности |
| `agents/whale_watcher.py` | Анализ ончейн/ордерфлоу китов | **Обновлён**: ingest on-chain + order flow, комбинированный скоринг | Качество зависит от доступности Dune/ccxt, нужны дополнительные признаки и таргет | Расширить набор источников, внедрить контроль качества сигналов и мониторинг Precision/Recall |
| `agents/pattern_discovery.py` | Поиск повторяющихся сетапов перед сильными движениями | **Работает**, но требует контроля качества | Зависит от LLM; нет ограничений на частоту запросов; критерии успеха фиксированы | Добавить лимиты/кэш для ccxt, логику повторных попыток, расширить статистические проверки (например, U-тест), хранить отчеты о качестве |
| `reasoning/chart_reasoning.py` | LLM-теханализ, объяснения и сентимент | **Работает**, обеспечивает RAG-поддержку | Полностью зависит от OpenAI, нет fallback; конфиденциальность данных | Добавить локальный режим/температуру из конфига, подготовить юнит-тесты на парсинг снапшота |
| `trading/trade_recommend.py` | Формирование карточки сделки, риск-менеджмент | **Работает**, но параметры жестко заданы | Расчет размера позиции игнорирует плечо и контрактные спецификации; порог `proba_up` жесткий | Ввести конфигурацию по символам, добавлять проскальзывание/комиссию, пересмотреть формулу confidence |
| `trading/verifier.py` | Верификация перед публикацией | **Работает**, простые правила | Порог ширины интервала фиксирован, не масштабируется по таймфрейму; нет журналирования отказов | Добавить метрики отказов, привязать пороги к ATR/волатильности |
| `agents/cognitive_architect.py` | Авто-оптимизация промптов агентов | **Работает**, обновляет конфиги | Нет логирования версий промптов, нет оценки эффекта | Вести changelog, валидировать JSON до записи |
| `agents/knowledge_core.py` | RAG-хранилище стратегий/статей | **Работает**, есть fallback | Для HTTP-источников требуется явное разрешение, нет очистки устаревших документов | Добавить планировщик пересборки, тесты на хэш-модель |
| `agents/memory_compressor.py` | Автоматическое сжатие lessons для PostMortem и Regime Trust | **Обновлён**: структурированные карточки, fallback-метрики качества, записи в БД по полям (title/insight/action/risk) | Нужна регулярная валидация LLM-режима и кросс-проверка метрик fallback с фактическим PnL | Подключить мониторинг качества LLM-ответов, связать agent_lesson_metrics с PostMortem-отчётами |
| `pipeline/orchestration/agent_flow.py` | Батч-оркестрация агентов | **Работает**, но тяжёлый | Нет изоляции ошибок, повторяет ccxt вызовы | Ввести кэш цен, переносить тяжелые шаги в ingest |
| `telegram_bot/publisher.py`, `telegram_bot/subscriptions.py`, `telegram_bot/menus.py`, `telegram_bot/messages.py` | Телеграм-интерфейсы и платежи | **Сконсолидировано**: логика перенесена в пакет Telegram | Нужны UI/интеграционные тесты, контроль локализаций | Подключить линтеры в CI (compileall), покрыть критические колбэки smoke-тестами |

## Выводы по точности прогнозов

1. **Alpha Hunter**: добавлены комиссии/проскальзывания и метрики — теперь нужно проверить устойчивость стратегий на реальных данных и автоматизировать анализ влияния на `confidence`.
2. **SMC и Whale**: базовая логика усилена (кэш, реальные метрики), следующий шаг — собрать размеченный датасет и измерить точность сетапов.
3. **LLM-инструменты**: по-прежнему зависит от OpenAI; важно внедрить fallback и лимиты токенов, а также отслеживать стоимость.
4. **Телеграм/Payments**: синтаксис исправлен и включён compileall в CI; требуется smoke/интеграция перед релизом.

## Следующие шаги (по приоритету)

1. **Alpha Hunter**: провести e2e-тесты с реальными API/прокси, автоматизировать отчётность по expectancy и влиянию на финальный confidence.
2. **SMC & Whale**: подготовить размеченный исторический датасет, настроить регулярный бэктест и мониторинг качества сетапов.
3. **LLM reasoning**: внедрить fallback-путь и логирование затрат, сформировать тесты на парсинг снапшота.
4. **Telegram/Payments**: дописать smoke-/UI-тесты и включить их в CI, расширить статанализ (ruff/mypy) на соответствующие пакеты.
